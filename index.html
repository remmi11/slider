<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Map</title>

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>


    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.2.3/dist/esri-leaflet.js" integrity="sha512-YZ6b5bXRVwipfqul5krehD9qlbJzc6KOGXYsDjU9HHXW2gK57xmWl2gU6nAegiErAqFXhygKIsWPKbjLPXVb2g=="
        crossorigin=""></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">


    <link rel="stylesheet" href="css/style.css">

</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Project name</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a class="closebtn" href="#">Contact</a></li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
        <!--/.container-fluid -->
    </nav>

    <div id="map"></div>

    <div class="container bs-example">
        <div class="panel-group" id="accordion">
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            7/28/16
                            <i class="fa fa-angle-down pull-right" style="font-size:24px"></i>
                        </a>
                    </h4>
                </div>
                <div id="collapseOne" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div class="slidecontainer">
                            <p>Time Range: <span class="slider-time1_1">9:00 AM</span> - <span class="slider-time1_2">5:00
                                    PM</span></p>
                            <div class="sliders_step1">
                                <div id="slider-range1"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                            8/24/16
                            <i class="fa fa-angle-down pull-right" style="font-size:24px"></i>
                        </a>
                    </h4>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div class="slidecontainer">
                            <p>Time Range: <span class="slider-time2_1">9:00 AM</span> - <span class="slider-time2_2">5:00
                                    PM</span></p>
                            <div class="sliders_step1">
                                <div id="slider-range2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                            8/28/16
                            <i class="fa fa-angle-down pull-right" style="font-size:24px"></i>
                        </a>
                    </h4>
                </div>
                <div id="collapseThree" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div class="slidecontainer">
                            <p>Time Range: <span class="slider-time3_1">9:00 AM</span> - <span class="slider-time3_2">5:00
                                    PM</span></p>
                            <div class="sliders_step1">
                                <div id="slider-range3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <script>

        var startDateQuery = '7/28/16 12:01:00 AM';
        var endDateQuery = '7/28/16 11:59:00 PM';

        var map = L.map('map').setView([32.70573349, -103.117694], 15);
        L.esri.basemapLayer('Imagery').addTo(map);
        L.esri.basemapLayer('ImageryTransportation').addTo(map);
        var myService1 = 'https://services5.arcgis.com/6gTxIFMxZdWxCrVQ/arcgis/rest/services/unique_7_28_16/FeatureServer/0';
        var myService2 = 'https://services5.arcgis.com/6gTxIFMxZdWxCrVQ/arcgis/rest/services/unique_8_24_16/FeatureServer/0';
        var myService3 = 'https://services5.arcgis.com/6gTxIFMxZdWxCrVQ/arcgis/rest/services/unique_8_28_16/FeatureServer/0';

        // L.esri.query({
        //     url: myService1
        // }).where("(date_cst BETWEEN DATE '" + startDateQuery + "' AND DATE '" + endDateQuery + "')").run(function (error, neighborhoods) {
        //     // draw neighborhood on the map
        //     trucks = L.geoJSON(neighborhoods);
        //     removeAllLayers();
        //     map.addLayer(trucks);
        //     trucks.bindPopup(function (layer) {
        //         return L.Util.template('<p class="custom-popup"><span id="popup-header">{Timestamp_CST}</span><br>Unit ID: {Unit_ID}<br>Lat: {Ping_Latitude}<br>Long: {Ping_Longitude}</p>', layer.feature.properties);
        //     });
        // });


        function removeAllLayers() {
            if (map._layers == undefined)
                return;

            var index = 0;
            for (var key in map._layers) {
                index += 1;
                if (index == 1)
                    continue;

                if (map._layers.hasOwnProperty(key)) {
                    map.removeLayer(map._layers[key]);
                }
            }
        }

        function slideChange(time1, time2, service) {
            L.esri.query({
                url: service
            }).where("(date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "')").run(function (error, neighborhoods) {
                // draw neighborhood on the map
                trucks = L.geoJSON(neighborhoods);
                removeAllLayers();
                map.addLayer(trucks);
                trucks.bindPopup(function (layer) {
                    return L.Util.template('<p class="custom-popup"><span id="popup-header">{date_cst2}</span><br>Unit ID: {Unit_ID}<br>Lat: {Ping_Latitude}<br>Long: {Ping_Longitude}</p>', layer.feature.properties);
                });
            });
        }

        //7/28/16
        $("#slider-range1").slider({
            range: true,
            min: 0,
            max: 1440,
            step: 15,
            values: [0, 1440],
            slide: function (e, ui) {

                var hours1 = Math.floor(ui.values[0] / 60);
                var minutes1 = ui.values[0] - (hours1 * 60);

                if (hours1.length == 1) hours1 = '0' + hours1;
                if (minutes1.length == 1) minutes1 = '0' + minutes1;
                if (minutes1 == 0) minutes1 = '00';
                if (hours1 >= 12) {
                    if (hours1 == 12) {
                        hours1 = hours1;
                        minutes1 = minutes1 + " PM";
                    } else {
                        hours1 = hours1 - 12;
                        minutes1 = minutes1 + " PM";
                    }
                } else {
                    hours1 = hours1;
                    minutes1 = minutes1 + " AM";
                }
                if (hours1 == 0) {
                    hours1 = 12;
                    minutes1 = minutes1;
                }

                var time1 = '7/28/16 ' + hours1 + ':' + minutes1
                $('.slider-time1_1').html(time1);

                var hours2 = Math.floor(ui.values[1] / 60);
                var minutes2 = ui.values[1] - (hours2 * 60);

                if (hours2.length == 1) hours2 = '0' + hours2;
                if (minutes2.length == 1) minutes2 = '0' + minutes2;
                if (minutes2 == 0) minutes2 = '00';
                if (hours2 >= 12) {
                    if (hours2 == 12) {
                        hours2 = hours2;
                        minutes2 = minutes2 + " PM";
                    } else if (hours2 == 24) {
                        hours2 = 11;
                        minutes2 = "59 PM";
                    } else {
                        hours2 = hours2 - 12;
                        minutes2 = minutes2 + " PM";
                    }
                } else {
                    hours2 = hours2;
                    minutes2 = minutes2 + " AM";
                }
                //7/28/16 10:43 AM
                var time2 = '7/28/16 ' + hours2 + ':' + minutes2
                $('.slider-time1_2').html(time2);

                console.log("(date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "')")
                // console.log("date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "'")
                slideChange(time1, time2, myService1)
            }
        });

        //8/24/16
        $("#slider-range2").slider({
            range: true,
            min: 0,
            max: 1440,
            step: 15,
            values: [0, 1440],
            slide: function (e, ui) {

                var hours1 = Math.floor(ui.values[0] / 60);
                var minutes1 = ui.values[0] - (hours1 * 60);

                if (hours1.length == 1) hours1 = '0' + hours1;
                if (minutes1.length == 1) minutes1 = '0' + minutes1;
                if (minutes1 == 0) minutes1 = '00';
                if (hours1 >= 12) {
                    if (hours1 == 12) {
                        hours1 = hours1;
                        minutes1 = minutes1 + " PM";
                    } else {
                        hours1 = hours1 - 12;
                        minutes1 = minutes1 + " PM";
                    }
                } else {
                    hours1 = hours1;
                    minutes1 = minutes1 + " AM";
                }
                if (hours1 == 0) {
                    hours1 = 12;
                    minutes1 = minutes1;
                }

                var time1 = '8/24/16 ' + hours1 + ':' + minutes1
                $('.slider-time2_1').html(time1);

                var hours2 = Math.floor(ui.values[1] / 60);
                var minutes2 = ui.values[1] - (hours2 * 60);

                if (hours2.length == 1) hours2 = '0' + hours2;
                if (minutes2.length == 1) minutes2 = '0' + minutes2;
                if (minutes2 == 0) minutes2 = '00';
                if (hours2 >= 12) {
                    if (hours2 == 12) {
                        hours2 = hours2;
                        minutes2 = minutes2 + " PM";
                    } else if (hours2 == 24) {
                        hours2 = 11;
                        minutes2 = "59 PM";
                    } else {
                        hours2 = hours2 - 12;
                        minutes2 = minutes2 + " PM";
                    }
                } else {
                    hours2 = hours2;
                    minutes2 = minutes2 + " AM";
                }
                //7/28/16 10:43 AM
                var time2 = '8/24/16 ' + hours2 + ':' + minutes2
                $('.slider-time2_2').html(time2);

                console.log("(date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "')")
                // console.log("date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "'")
                slideChange(time1, time2, myService2)
            }
        });

        //8/28/16
        $("#slider-range3").slider({
            range: true,
            min: 0,
            max: 1440,
            step: 15,
            values: [0, 1440],
            slide: function (e, ui) {

                var hours1 = Math.floor(ui.values[0] / 60);
                var minutes1 = ui.values[0] - (hours1 * 60);

                if (hours1.length == 1) hours1 = '0' + hours1;
                if (minutes1.length == 1) minutes1 = '0' + minutes1;
                if (minutes1 == 0) minutes1 = '00';
                if (hours1 >= 12) {
                    if (hours1 == 12) {
                        hours1 = hours1;
                        minutes1 = minutes1 + " PM";
                    } else {
                        hours1 = hours1 - 12;
                        minutes1 = minutes1 + " PM";
                    }
                } else {
                    hours1 = hours1;
                    minutes1 = minutes1 + " AM";
                }
                if (hours1 == 0) {
                    hours1 = 12;
                    minutes1 = minutes1;
                }

                var time1 = '8/28/16 ' + hours1 + ':' + minutes1
                $('.slider-time3_1').html(time1);

                var hours2 = Math.floor(ui.values[1] / 60);
                var minutes2 = ui.values[1] - (hours2 * 60);

                if (hours2.length == 1) hours2 = '0' + hours2;
                if (minutes2.length == 1) minutes2 = '0' + minutes2;
                if (minutes2 == 0) minutes2 = '00';
                if (hours2 >= 12) {
                    if (hours2 == 12) {
                        hours2 = hours2;
                        minutes2 = minutes2 + " PM";
                    } else if (hours2 == 24) {
                        hours2 = 11;
                        minutes2 = "59 PM";
                    } else {
                        hours2 = hours2 - 12;
                        minutes2 = minutes2 + " PM";
                    }
                } else {
                    hours2 = hours2;
                    minutes2 = minutes2 + " AM";
                }
                //7/28/16 10:43 AM
                var time2 = '8/28/16 ' + hours2 + ':' + minutes2
                $('.slider-time3_2').html(time2);

                console.log("(date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "')")
                // console.log("date_cst BETWEEN DATE '" + time1 + "' AND DATE '" + time2 + "'")
                slideChange(time1, time2, myService3)
            }
        });

        $(".closebtn").click(function () {
            $(".bs-example").slideToggle();

        });

        //add lines
        var route2 = L.esri.featureLayer({
            url: 'https://services5.arcgis.com/6gTxIFMxZdWxCrVQ/arcgis/rest/services/line_8_24_16/FeatureServer/0',
            style: function (feature) {
                var c, o;
                o = 0.75;
                c = '#007D7D';
                return { color: c, opacity: o, weight: 5 };
            }
        }).addTo(map);
    </script>
</body>

</html>